(self.mfeModules=self.mfeModules||[]).push(["",["Platform","React","PlatformApi","Redux","ReactRedux","ReactRouter","WithInjectReducer","FeatureToggles","Account","PrometheusTracker","ReactDom","ReactDomServer"],(t,e,a,r,i,s,n,o,c,l,u,d)=>()=>{(self.wpJsonpPcmallRating=self.wpJsonpPcmallRating||[]).push([[190],{2737:(t,e,a)=>{"use strict";a.microfeA(t,(function(){return Promise.all([a.microfeM(1),a.microfeM(2),a.microfeM(3),a.microfeM(4),a.microfeM(0)]).then((function(){t.exports=e,a.d(e,{Z:()=>Rt});var r=a(3804),i=a.n(r),s=a(6704),n=a(9323);const o=(0,r.createContext)(null),c=(0,r.createContext)(null);let l;function u(){return l}var d;!function(t){t[t.setTimeout=0]="setTimeout",t[t.setInterval=1]="setInterval",t[t.requestAnimationFrame=2]="requestAnimationFrame",t[t.defer=3]="defer"}(d||(d={}));const p="undefined"==typeof window&&"undefined"==typeof document,h=!p,m=new Error("TaskTimeout"),g=Promise.resolve();function _(t,e){const a={id:e,status:2,value:t.then((t=>{a.status=0;const e=a._v;return e.data=t,e.err=null,e.pending=!1,e.staled=!1,t}),(t=>{a.status=1;const e=a._v;throw e.err=t,e.pending=!1,e.staled=!1,t})),_v:{pending:!0,staled:!1,data:null,uid:e,err:null}};u().taskStack.push(a)}function f(t){return u().taskStack.filter((e=>e.id===t))[0]}function v(){return{stackSSRTask:_,getSSRTask:f}}const w=Object.freeze(new Error("DeferCancelled")),y=Object.freeze({afterCancel:"pending"});class b{constructor(t=y){var e=this;this.options=t,this.status="pending",this._promise=new Promise(((t,e)=>{this.resolve=a=>{var r;"pending"===this.status?(r=a)&&"function"==typeof r.then?a.then(this.resolve,this.reject):(this.status="resolved",t(a)):"canceled"===this.status&&("reject"===this.options.afterCancel?e(w):"resolve"===this.options.afterCancel&&t(w))},this.reject=t=>{"pending"===this.status&&(this.status="rejected",e(t))}})),this.then=(t,e)=>this._promise.then((e=>"resolved"===this.status?t(e):e),(t=>{if(e&&("canceled"===this.status||"rejected"===this.status))return e(t);throw t})),this.catch=async function(t){try{return await e._promise}catch(a){if(e.status="resolved",t)return t(a);throw a}},this.cancel=()=>{this.status="canceled",this.resolve(null)},this.finally=t=>(this._promise=this._promise.then((e=>(t(),e)),(e=>{throw t(),e})),this)}}function S(){return S=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},S.apply(this,arguments)}let R=0;const k=()=>{};async function E(t){return new Promise((e=>{setTimeout((()=>e(null)),t)}))}const T=["ssrTimeout","query","keyMaker"];function M(){return M=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},M.apply(this,arguments)}function I(t,e){const a=(0,r.useContext)(o);return function(t,e=[]){const a=function(){const t=(0,r.useState)(0)[1];return()=>{t((t=>255&++t))}}(),{task:i,cache:s,keyMaker:n,loop:l,onComplete:u,onError:d,onSSRTaskTimeout:h,ssrTimeout:g,retain:_,ssr:f,disabled:w=!1}=(0,r.useMemo)(t,e),y=(0,r.useContext)(o).taskMng,T=(0,r.useContext)(c),{getSSRTask:M,stackSSRTask:I}=v(),P=(0,r.useState)((()=>({unsub:k,reset(){this.unsub(),this.unsub=k}})))[0],C="function"==typeof n?n():n||(255&R++)+"";(0,r.useMemo)((()=>{if(f&&p){let t=null;if(T)t=T[C];else{const e=M(C);if(e&&0===e.status&&(t=e._v),!e){const t=function(t,e){return e?()=>new Promise(((a,r)=>{a(t()),setTimeout((()=>{r(m)}),e)})):t}(i,g),e=t();I(e.catch((t=>{throw h&&h(),d&&d(t),t})),C)}}t?(u&&(t.pending||u(t)),y.add({task:null,id:C,cachePolicy:s,currentValue:t,inActive:w})):y.add({task:null,id:C,inActive:w,cachePolicy:s,currentValue:{pending:!0,data:null,err:null,staled:!1,uid:C}})}else P.reset(),y.add({task:i,id:C,cachePolicy:s,inActive:w})}),[C]);const O=(0,r.useMemo)((()=>{if(!l)return!1;const t={count:1/0,interval:1e3,mode:"exhaust"};return"object"==typeof l&&Object.assign(t,l),t}),[l]),F=(0,r.useRef)(!1),N=(0,r.useRef)(k),x=(0,r.useRef)(k);(0,r.useEffect)((()=>{if(!l||!O||w)return;F.current=!1;const{interval:t,mode:e,count:r}=O;let s=0;const n=async()=>{switch(e){case"exhaust":await y.add({task:i,id:C,cachePolicy:"cache-first",isLooping:!0,inActive:!1}),await E(t);break;case"switch":await Promise.race([y.add({task:i,id:C,cachePolicy:"cache-first",isLooping:!0,inActive:!1}),E(t)])}},o=async()=>{const t=new b;return N.current=()=>{t.resolve(),N.current=k,F.current=!1,P.unsub(),P.unsub=y.subscribeTaskById(C,a)},t};return(async()=>{for(;s++<=r;)F.current?await o():await n()})(),x.current=()=>{s=0,F.current=!0,P.unsub(),P.unsub=k},()=>{N.current=x.current=k,F.current=!0}}),[l,w]);const j=y.getTaskStateById(C),A=(0,r.useRef)(null);(0,r.useEffect)((()=>{const t=y.getTaskStateById(C);return(null==j?void 0:j.uid)===(null==t?void 0:t.uid)&&["data","pending"].some((e=>(null==j?void 0:j[e])!==(null==t?void 0:t[e])))&&a(),P.unsub=y.subscribeTaskById(C,a),()=>{P.reset()}}),[C]),(0,r.useEffect)((()=>{!_||!1!==(null==j?void 0:j.pending)||j.staled||j.err||(A.current=null==j?void 0:j.data)}),[j,_]),(0,r.useDebugValue)(j),(0,r.useEffect)((()=>{u&&!w&&j&&j.data&&!j.pending&&!j.staled&&u(j)}),[j,w,u]);const W=(0,r.useCallback)((()=>{y.add({task:i,id:C,cachePolicy:s,refresh:!0,inActive:!1})}),[y,i,C,s]);return(0,r.useMemo)((()=>{const t=S({},j);return _&&t.pending&&(t.data=A.current,t.staled=!0),S({},t,{refresh:W})}),[j])}((()=>{const e=t(),{ssrTimeout:r=1/0,query:i,keyMaker:s}=e,n=function(t,e){if(null==t)return{};var a,r,i={},s=Object.keys(t);for(r=0;r<s.length;r++)a=s[r],e.indexOf(a)>=0||(i[a]=t[a]);return i}(e,T),o="function"==typeof s?s():s;return M({keyMaker:o,task:()=>{const t=a.service;return i(t)},onSSRTaskTimeout:()=>{a.onSSRTaskTimeout&&a.onSSRTaskTimeout({type:"Query",metadata:{uid:o,ssrTimeout:r}})},ssrTimeout:r},n)}),e)}var P,C,O=a(2714);function F(){return F=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},F.apply(this,arguments)}!function(t){t[t.NotSpecified=0]="NotSpecified",t[t.WithComment=1]="WithComment",t[t.WithPhoto=2]="WithPhoto",t[t.WithVideo=3]="WithVideo",t[t.LocalReview=9]="LocalReview",t[t.RepeatPurchase=10]="RepeatPurchase",t[t.OverallFitSmall=11]="OverallFitSmall",t[t.OverallFitFit=12]="OverallFitFit",t[t.OverallFitLarge=13]="OverallFitLarge"}(P||(P={})),function(t){t[t.All=0]="All",t[t.OneStar=1]="OneStar",t[t.TwoStar=2]="TwoStar",t[t.ThreeStar=3]="ThreeStar",t[t.FourStar=4]="FourStar",t[t.FiveStar=5]="FiveStar"}(C||(C={}));const N=Object.freeze({});class x{constructor(t={}){this._updateQueue=new Set,this._cache={},this._defaultTaskResult=F({},t.defaultTaskResult||{}),this._taskStateMap={},this._observerMap={},Object.keys(this._taskStateMap).forEach((t=>{this._observerMap[t]=[]}))}taskIsRunning(t){const e=this.getTaskStateById(t);return!!e&&(e.pending||e.staled)}exist(t){return void 0!==this._taskStateMap[t]}getTaskStateById(t){return this._taskStateMap[t]}async add(t){var e;const{task:a,id:r,cachePolicy:i,currentValue:s,inActive:n,isLooping:o=!1}=t,c=this.getTaskStateById(r);if(this.taskIsRunning(r))return null!==(e=null==c?void 0:c._p)&&void 0!==e?e:g;const l=this._defaultTaskResult[r];if(null==l?void 0:l.data)return this._taskStateMap[r]=l,"number"!=typeof i&&"cache"!==i&&"cache-first"!==i||this._addCache(r,l.data),o&&this._commitUpdate(r),g;if(s)return this._taskStateMap[r]=s,g;const u={err:null,staled:!1,pending:!n,data:null,uid:r,_p:g};this._taskStateMap[r]=u;let d=null;if(this._existCache(r)){const t=this._cache[r];"number"==typeof i&&Date.now()-t.t<i||"cache"===i?d=t.data:"cache-first"===i&&(d=t.data,u.staled=!0)}return d&&(u.data=d,u.pending=!1),this._commitUpdate(r),u.pending||u.staled?(u._p=a().then((t=>{let e=this.getTaskStateById(r);const a=this._observerMap[r];e&&(e=F({},e),this._taskStateMap[r]=e,e.data=t,e.staled=e.pending=!1,e.err=null,e._t=Date.now()),a&&a.length&&(this._commitUpdate(r),i&&this._addCache(r,t))}),(t=>{let e=this.getTaskStateById(r);const a=this._observerMap[r];e&&(e=F({},e),this._taskStateMap[r]=e,e.data=d,e.staled=e.pending=!1,e.err=t,e._t=Date.now(),t===m&&h&&(e.pending=!0,e.err=null)),a&&a.length&&this._commitUpdate(r)})),u._p):g}del(t){delete this._taskStateMap[t],delete this._observerMap[t],delete this._cache[t]}subscribeTaskById(t,e){return this._observerMap[t]=this._observerMap[t]||[],this._observerMap[t].push(e),()=>{const a=this._observerMap[t];if(!a)return;const r=a.length;for(let t=0;t<r;t++)if(a[t]===e)return void a.splice(t,1);0===this._observerMap[t].length&&delete this._observerMap[t]}}destroy(){this._taskStateMap=this._observerMap=this._defaultTaskResult=this._cache=this._updateQueue=null}_commitUpdate(t){const e=this.getTaskStateById(t);e&&!this._updateQueue.has(t)&&(this._updateQueue.add(t),this._taskStateMap[t]=F({},e),this._flushUpdateQueue())}_flushUpdateQueue(){p||setTimeout((()=>{this._updateQueue.forEach((t=>{this._observerMap[t]&&this._observerMap[t].forEach((t=>{t()}))})),this._defaultTaskResult=N,this._updateQueue.clear()}),4)}_existCache(t){return!!this._cache[t]}_addCache(t,e){e&&(this._cache[t]={data:e,t:Date.now()})}}function j(){return j=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},j.apply(this,arguments)}function A(t){const e=(0,r.useContext)(c),{children:a,service:s={}}=t,n=t.taskResult||e||{},[l]=(0,r.useState)((()=>{const t=j({},s);return{value:t,add:function(e){const a=Object.keys(e);return a.forEach((a=>{t[a],t[a]=e[a]})),()=>{a.forEach((e=>{delete t[e]}))}}}})),u=(0,r.useState)((()=>{const t=new x({defaultTaskResult:n});return{service:l.value,addServices:l.add,taskMng:t}}))[0];return(0,r.useEffect)((()=>{window.axon_task_mng=u.taskMng})),i().createElement(o.Provider,{value:u},a)}var W=a(6835);const $={getItemRating:t=>L("/api/v2/item/get_rating",t),getRatingTagFilters:t=>L("/api/v2/item/get_rating_tagfilters",t),getUserRatingSummary:t=>L("/api/v2/user/get_rating_summary",t),getVariationFilter:t=>L("/api/v4/item/get_rating_variation_filters",t),getRatings:t=>L("/api/v2/item/get_ratings",t),getMyRatingList:t=>L("/api/v4/item/get_my_rating_list",t),getMyRatableList:t=>L("/api/v4/item/get_my_ratable_list",t),getRatingMeta:t=>L("/api/v2/item/get_rating_meta",t)};async function L(t,e){const a=(0,O.stringifyUrl)({url:t,query:e}),{response:r}=await(0,W.Vn)(a);return r}function V(t){return i().createElement(A,{service:$},t.children)}var B=a(9325),D=a(9257),U=a(5325),Q=a(1306),K=a(5206),q=a(5404),Z=a(7762),z=a(2332),H=a(6566),G=a(7585),J=a(5518);const{t:Y}=s.I18n,X=({ratingScore:t,ratingCountForStarsInArray:e,ratingCountForFiltersInArray:a,selectedGenericFilter:r,onSwitchFilter:s,hideExtraFilter:n,showLocalReview:o=!1,showRepeatPurchase:c})=>{const l=[{value:1,classModifier:t=>1===t?["active","all"]:["all"],label:Y("label_all")}];return[4,3,2,1,0].map((t=>{l.push({value:2<<t,label:`${t+1} ${Y("label_rating_star")} (${(0,J.localizeCompactNumber)((0,G.Kd)(),e[t+1])})`,classModifier:e=>e===2<<t?["active"]:[]})})),n||(l.push({value:64,label:`${Y("label_with_comment")} (${(0,J.localizeCompactNumber)((0,G.Kd)(),a[1])})`,classModifier:t=>64===t?["active","with-comment"]:["with-comment"]},{value:256,label:`${Y("rating_btn_name_ratingfilter_media")} (${(0,J.localizeCompactNumber)((0,G.Kd)(),a[2])})`,classModifier:t=>256===t?["active","with-photo"]:["with-photo"]}),c&&l.push({value:32768,label:`${Y("label_repeat_purchase")} (${(0,J.localizeCompactNumber)((0,G.Kd)(),a[10])})`,classModifier:t=>32768===t?["active","repeat-purchase"]:["repeat-purchase"]}),o&&l.push({value:16384,label:`${Y("label_local_review")} (${(0,J.localizeCompactNumber)((0,G.Kd)(),a[9])})`,classModifier:t=>16384===t?["active","local-review"]:["local-review"]})),i().createElement("div",{className:"product-rating-overview"},i().createElement("div",{className:"product-rating-overview__briefing"},i().createElement("div",{className:"product-rating-overview__score-wrapper"},i().createElement("span",{className:"product-rating-overview__rating-score"},t%1==0?t:t&&t.toFixed(1)),i().createElement("span",{className:"product-rating-overview__rating-score-out-of"},Y("text_n_out_of_m",{n:"",m:5})+" ")),i().createElement(z.DU,{rating:t,className:"product-rating-overview__stars"})),i().createElement("div",{className:"product-rating-overview__filters"},l.map((t=>i().createElement("div",{key:t.value,onClick:()=>{s(t.value)},className:(0,H.Z)("product-rating-overview__filter",t.classModifier(r))},t.label)))))},tt=32,et=1;function at(t){return 1===t?{filter:0,star:0}:{filter:t>tt?Math.log2(t/tt):0,star:t>et&&t<=tt?Math.log2(t/et):0}}const rt=a.p+"eac95a8ac896158642c2761a9e9cd52e.png";function it(){return it=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},it.apply(this,arguments)}const{t:st}=s.I18n;class nt extends r.Component{constructor(t){super(t),this._view=null,this.combineQueryFromState=(t,e)=>{const{filter:a,star:r}=at(t.genericFilter);return it({},e.queryObject,{filter:a,type:r,offset:0})},this.onSwitchPage=t=>{this.setState(((e,a)=>{const r=it({},this.combineQueryFromState(e,a),{offset:6*t}),{ratingState:i}=a,s=(0,Q.kK)(i,r),n=!s||s.hasMore,o=this.props.selectItemRatings(i,r);return o&&0!==o.length||!n||this.props.fetchItemRatings(r),this.scrollToTopOfRatings(),it({},e,{selectedPage:t})}))},this.scrollToTopOfRatings=()=>{const t=window.document.documentMode;this._view&&(t?this._view.scrollIntoView():this._view.scrollIntoView({behavior:"smooth",block:"start"}))},this.onSwitchFilter=t=>{this.setState(((e,a)=>{const{filter:r,star:i}=at(t),s=it({},this.combineQueryFromState(e,a),{filter:r,type:i});this.props.onFilterTypeChanged&&this.props.onFilterTypeChanged(i);const{ratingState:n}=a,o=this.props.selectItemRatings(n,s);return o&&0!==o.length||this.props.fetchItemRatings(s),it({},e,{selectedPage:0,genericFilter:t})}))};const e=Number.isInteger(this.props.filterType)&&null!=this.props.filterType?1<<this.props.filterType:1;this.state={selectedPage:0,genericFilter:e}}UNSAFE_componentWillMount(){this.props.injectAsyncReducer({rating:Q.I6});const t=this.combineQueryFromState(this.state,this.props),{ratingState:e}=this.props,a=this.props.selectItemRatings(e,t);a&&0!==a.length||this.props.fetchItemRatings(t)}componentDidUpdate(t){this.props.itemId!==t.itemId&&this.setState({selectedPage:0,genericFilter:1}),this.props.filterType!==t.filterType&&null!=this.props.filterType&&Number.isInteger(this.props.filterType)&&this.setState({genericFilter:1<<this.props.filterType})}render(){const{productRating:t,ratingState:e,shopId:a,ratingStar:i,selectItemRatings:s}=this.props,n=t.ratingCount,o=this.state.genericFilter?parseInt(`${this.state.genericFilter}`,10):1,{filter:c,star:l}=at(o),u=it({},this.props.queryObject,{filter:c,type:l,offset:6*this.state.selectedPage}),d=(0,Q.kK)(e,u),p=!!d&&d.downgradeSwitch,h=!d||d.hasMore,m=d?h?d.offset:d.offset-6:0,g=e&&s(e,u),_=n?n[l]:0,f=n||[0,0,0,0,0,0],v=[0,null!=t.rcountWithCmt?t.rcountWithCmt:0,null!=t.rcountWithImg?t.rcountWithImg:0,null!=t.rcountWithImg?t.rcountWithImg:0,0,0,0,0,0,t.rcountLocalReview||0,t.rcountRepeatPurchase||0],w=0!==c?v[c]:_;return r.createElement("div",{className:"product-ratings",ref:t=>{this._view=t},"data-nosnippet":!0},!this.props.isUserRating&&r.createElement("div",{className:"product-ratings__header"},r.createElement("div",{className:"product-ratings__header_score"},st("label_product_ratings"))),!p&&r.createElement(X,{ratingScore:i,ratingCountForStarsInArray:f,ratingCountForFiltersInArray:v,selectedGenericFilter:o,onSwitchFilter:this.onSwitchFilter,hideExtraFilter:this.props.hideExtraFilter,showLocalReview:e.show_local_review,showRepeatPurchase:!!(t.rcountRepeatPurchase&&t.rcountRepeatPurchase>0)}),p&&0===w&&0===(null==d?void 0:d.ratings.length)||!p&&0===w?r.createElement("div",{className:"product-ratings-comments-view__no-data"},r.createElement("div",{className:"product-ratings-comments-view__no-data__icon"},r.createElement("img",{src:rt,alt:"No rating"})),r.createElement("div",{className:"product-ratings-comments-view__no-data__text"},st("text_no_ratings")),this.props.isUserRating?r.createElement("div",{className:"product-ratings-comments-view__no-data__desc"},st("label_buyer_rating_empty_desc")):null):r.createElement("div",{className:"product-ratings__list"},r.createElement("div",{className:"shopee-product-comment-list"},!!g&&g.map((t=>t&&r.createElement(q.Z,{key:t.cmtid,rating:t,shopId:a,itemId:t.itemid,noAction:this.props.noAction,likeRating:this.props.likeRating,unlikeRating:this.props.unlikeRating,productItems:t.product_items,isUserRating:this.props.isUserRating,showProducts:this.props.showProducts})))),r.createElement(K.ZP,{className:"product-ratings__page-controller",totalPageCount:Math.floor((p?m:w-1)/6)+1,selectedPage:this.state.selectedPage,onPageSelected:this.onSwitchPage})))}}nt.defaultProps={selectItemRatings:Q.N7};const ot={rating_total:0,rating_count:[0,0,0,0,0],rcount_with_context:0,rcount_with_image:0,rcount_with_media:0,rcount_local_review:0,rcount_repeat_purchase:0},ct=(0,D.Pf)((0,U.connect)(((t,e)=>{const{shopId:a,userId:r,itemId:i}=e,s=t.rating,n={shopId:a,itemId:i,userId:r,flag:1,limit:6},o=(e.selectItemRatingSummary||Q.EM)(s)||ot;return{queryObject:n,ratingState:s,productRating:{ratingCount:[o.rating_total,...o.rating_count.length?o.rating_count:[0,0,0,0,0]],rcountWithCmt:o.rcount_with_context,rcountWithImg:o.rcount_with_media,rcountLocalReview:o.rcount_local_review,rcountRepeatPurchase:o.rcount_repeat_purchase}}}),((t,e)=>({fetchItemRatings:a=>{e.fetchItemRatings?e.fetchItemRatings(a):t((0,Q._L)(a))}})))((0,Z.withInjectReducer)((0,B.wl)(nt))));var lt=a(1651),ut=a.n(lt);function dt(t){const{onClick:e,active:a,content:r}=t;return i().createElement("div",{onClick:()=>{e(t)},className:ut()("product-rating-overview__filter",a&&"product-rating-overview__filter--active")},r)}function pt(t){const[e,a]=(0,r.useState)(0),{onChange:s,filters:n}=t;return i().createElement("div",{className:"product-rating-overview__filters"},n.map(((t,r)=>i().createElement(dt,{content:t.content,active:e===r,key:r,onClick:()=>{a(r);const e=t.payload;s(e)}}))))}const{t:ht}=s.I18n,mt=(0,G.Kd)();function gt(t){return(0,J.compactCurrency)(mt,t||0,{precision:!1,symbol:""})}let _t=function(t){return t[t.All=0]="All",t[t.WithMedia=1]="WithMedia",t[t.WithComment=2]="WithComment",t[t.RepeatPurchase=3]="RepeatPurchase",t[t.LocalReview=4]="LocalReview",t[t.Star=5]="Star",t}({});function ft(t){const{onSwitchFilter:e,ratingScore:a,ratingSummary:s,hideExtraFilter:n,showLocalReview:o,showRepeatPurchase:c}=t,[l]=(0,r.useState)((()=>({all:{type:_t.All},withMedia:{type:_t.WithMedia},withComment:{type:_t.WithComment},repeatPurchase:{type:_t.RepeatPurchase},localReview:{type:_t.LocalReview},star1:{type:_t.Star,value:1},star2:{type:_t.Star,value:2},star3:{type:_t.Star,value:3},star4:{type:_t.Star,value:4},star5:{type:_t.Star,value:5}}))),u=(0,r.useMemo)((()=>{const{rcount_local_review:t,rcount_repeat_purchase:e,rcount_with_context:a,rcount_with_media:r,rating_count:i}=s,u=[{content:ht("label_all"),payload:{type:_t.All}},...[5,4,3,2,1].map((t=>({content:`${t} ${ht("label_rating_star")} (${gt(i[t-1])})`,payload:l[`star${t}`]})))];return n||(u.push({content:`${ht("label_with_comment")} (${gt(a||0)})`,payload:l.withComment},{content:`${ht("rating_btn_name_ratingfilter_media")} (${gt(r||0)})`,payload:l.withMedia}),c&&u.push({payload:l.repeatPurchase,content:`${ht("label_repeat_purchase")} (${gt(e||0)})`}),o&&u.push({payload:l.localReview,content:`${ht("label_local_review")} (${gt(t||0)})`})),u}),[l,n,s,o,c]);return i().createElement("div",{className:"product-rating-overview"},i().createElement(vt,{ratingScore:a}),i().createElement(pt,{filters:u,onChange:e}))}function vt(t){const{ratingScore:e}=t;return i().createElement("div",{className:"product-rating-overview__briefing"},i().createElement("div",{className:"product-rating-overview__score-wrapper"},i().createElement("span",{className:"product-rating-overview__rating-score"},e%1==0?e:e&&e.toFixed(1)),i().createElement("span",{className:"product-rating-overview__rating-score-out-of"},ht("text_n_out_of_m",{n:"",m:5})+" ")),i().createElement(z.DU,{rating:e,className:"product-rating-overview__stars"}))}function wt(){return wt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},wt.apply(this,arguments)}const{t:yt}=s.I18n,bt={filter:P.NotSpecified,flag:1,limit:6,offset:0,type:C.All,exclude_filter:0,filter_size:0,fold_filter:0,relevant_reviews:!1,request_source:1,tag_filter:"",variation_filters:""},St=(0,D.Pf)((0,B.wl)((function(t){var e,a,s,n;const{itemId:o,shopId:c,ratingStar:l}=t,u=(0,r.useRef)(null),[d,p]=(0,r.useState)((()=>wt({},bt,{shopid:c,itemid:o}))),h=()=>{const t=u.current;if(t)try{const e=t.getBoundingClientRect().top+window.pageYOffset,a=window.getComputedStyle(t),r=a.paddingTop?parseInt(a.paddingTop,10):0,i=window.innerHeight,s=document.documentElement.scrollTop||document.body.scrollTop;if(document.documentElement.scrollTop-r<e&&i/2+s>=e)return;t.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}};(0,r.useEffect)((()=>{p(wt({},bt,{shopid:c,itemid:o}))}),[o,c]);const m=function(t){const e=(a=["shopid","itemid","offset","limit","filter","flag","type","tag_filter","exclude_filter","request_source","variation_filters","relevant_reviews","filter_size","fold_filter"],(t,e)=>a.indexOf(t)-a.indexOf(e));var a;return I((()=>({keyMaker:()=>`[getRatings]:${(0,O.stringify)(t,{sort:e,skipNull:!0,skipEmptyString:!0})}`,retain:!0,query:e=>e.getRatings(t),cache:"cache-first"})),[t])}(d);(0,r.useDebugValue)(m.data);const g=null==(e=m.data)?void 0:e.data;if(!g)return null;const _=g.downgrade_switch,f=g.item_rating_summary,v=f.rating_total||0,w=Math.floor((v-1)/6)+1;return i().createElement("div",{className:"product-ratings",ref:u,"data-nosnippet":!0},i().createElement("div",{className:"product-ratings__header"},i().createElement("div",{className:"product-ratings__header_score"},yt("label_product_ratings"))),!_&&i().createElement(ft,{ratingScore:l,ratingSummary:f,onSwitchFilter:t=>{const{type:e}=t;p((a=>{var r;const i=null!=(r={[_t.Star]:P.NotSpecified,[_t.LocalReview]:P.LocalReview,[_t.RepeatPurchase]:P.RepeatPurchase,[_t.WithComment]:P.WithComment,[_t.WithMedia]:P.WithVideo,[_t.All]:P.NotSpecified}[e.toString()])?r:P.NotSpecified;let s=C.All;return e===_t.Star&&(s=t.value),a.type===s&&a.filter===i?a:wt({},a,{filter:i,type:s,offset:0})})),h()},hideExtraFilter:!1,showLocalReview:null!=(a=g.show_local_review)&&a,showRepeatPurchase:f.rcount_repeat_purchase>0}),0===(null!=(s=null==g?void 0:g.ratings)?s:[]).length?i().createElement("div",{className:"product-ratings-comments-view__no-data"},i().createElement("div",{className:"product-ratings-comments-view__no-data__icon"},i().createElement("img",{src:rt,alt:"empty-icon"})),i().createElement("div",{className:"product-ratings-comments-view__no-data__text"},yt("text_no_ratings"))):i().createElement("div",{className:"product-ratings__list",style:{opacity:m.pending?.6:1}},i().createElement("div",{className:"shopee-product-comment-list"},(null!=(n=null==g?void 0:g.ratings)?n:[]).map((t=>t&&i().createElement(q.Z,{key:t.cmtid,rating:t,shopId:c,itemId:t.itemid,productItems:t.product_items})))),i().createElement(K.ZP,{className:"product-ratings__page-controller",totalPageCount:w,selectedPage:Math.floor(d.offset/6),onPageSelected:t=>{h(),p((e=>wt({},e,{offset:6*t})))}})))})));function Rt(t){const{isBuyerRating:e=!1}=t;return e?i().createElement(n.Z,{onTrack:s.Tracking.onTrack},i().createElement(ct,t)):i().createElement(V,null,i().createElement(n.Z,{onTrack:s.Tracking.onTrack},i().createElement(St,t)))}}))}))},17:t=>{"use strict";t.exports=c},1437:t=>{"use strict";t.exports=o},6161:e=>{"use strict";e.exports=t},6704:t=>{"use strict";t.exports=a},3332:t=>{"use strict";t.exports=l},3804:t=>{"use strict";t.exports=e},7274:t=>{"use strict";t.exports=u},5325:t=>{"use strict";t.exports=i},6775:t=>{"use strict";t.exports=s},4857:t=>{"use strict";t.exports=r},7762:t=>{"use strict";t.exports=n}},function(e){"use strict";var a;a=e.x,e.x=()=>{Promise.resolve(e(2737)).then((e=>{t.setModule("pcmall-productrating",e.Z,{type:"slot",buildInformation:{updated:"2023-05-08T03:47:38.959Z",tag:"RT-V20230511-WEB-0",branch:"heads/RT-V20230511-WEB-0",lastCommit:'feat(@shopee-rating/microfe-rating-pc): add a new micro app "pcmall-buyerrating"',lastCommitHash:"07c9d79d09123b35ec5807e603f9a01174c591bf"},registerSentryDsn:!0,projectAndModuleName:"pcmall-shoprating"}),a()}))}},[[2737,666,6,596,408]]])},2]),function(){if(window&&window.__DECKER_HOOK__){var t=window.__DECKER_HOOK__,e=function(){t.sendToDevtools("MFE_LOAD_SLOT",{slotName:"pcmall-productrating",updated:"2023-05-08T03:47:38.974Z",tag:"RT-V20230511-WEB-0",branch:"heads/RT-V20230511-WEB-0",lastCommit:'feat(@shopee-rating/microfe-rating-pc): add a new micro app "pcmall-buyerrating"',lastCommitHash:"07c9d79d09123b35ec5807e603f9a01174c591bf"})};t.on("MFE_RETRIEVE_SLOTS",e),e()}}();